// ---------------------
// Threat Chain - Seek Malicious Extensions
// Purpose: Use a query to tie account names and IDs to a browser and extension, 
// then check the extension and the version of the browser to determine the system's safety
// Use MakeTable.py to generate practice tables, or use the ones provided in the repository
// ---------------------

// 1) Insert the tables into Azure Data Explorer

// 2) Run the following query once data has been ingested
DeviceEvents
| join kind=innerunique DeviceTvmBrowserExtension on DeviceID // Joins the 2 tables together to have a collection of data
| where Browsername == "Chrome"
    and (ExtensionName == "myhouse.exe" // Singles out malicious files
    or ExtensionName == "puzzlepieces.exe")
| extend Version=split(Browserversion, ".") // Creates a list out of browser version to index and draw values from
| where toint(Version[0]) <= 139
    and toint(Version[2]) <= 7258
    and toint(Version[3]) < 66
| summarize by DeviceID, AccountName, Browserversion, ExtensionName // Display import details
// "| count" Can be input at the bottom of the query to get the amount of malicious extensions currently downloaded